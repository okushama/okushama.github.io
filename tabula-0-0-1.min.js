var tbl=function(){this.render_model=function(e,t){JSZipUtils.getBinaryContent(t,function(t,n){function a(e){return"string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}function r(){function t(e,t){var n=new THREE.DirectionalLight(16777215,.7);n.position.set(e,1,t).normalize(),p.add(n)}function n(e,t,n,a,i,o,s,l,u,c,E,d,m,g,v){function y(e,t,n){var a=g,r=v,l=i,u=o;0==e&&(a=a+s+i,r+=s,l=s),1==e&&(a=a,r+=s,l=s),2==e&&(a+=s,r=r-o+s,l=i,u=s),3==e&&(a+=s+i,r=r-o+s,l=i,u=s),4==e&&(a+=s,r+=s),5==e&&(a=a+2*s+i,r+=s),r=j-r;var c=a/M,p=r/j-o/j;part=[new THREE.Vector2(c,p+u/j),new THREE.Vector2(c,p),new THREE.Vector2(c+l/M,p),new THREE.Vector2(c+l/M,p+u/j)],f.faceVertexUvs[0][t]=[part[0],part[1],part[3]],f.faceVertexUvs[0][n]=[part[1],part[2],part[3]]}f=new THREE.BoxGeometry(i,o,s,0,0,0),h=r&&w?new THREE.MeshBasicMaterial({color:0,wireframe:!0}):new THREE.MeshPhongMaterial({map:T,transparent:!0,opacity:1}),y(0,0,1),y(1,2,3),y(2,4,5),y(3,6,7),y(4,8,9),y(5,10,11),f.applyMatrix((new THREE.Matrix4).makeTranslation(-i/2-E,-o/2-d,-s/2-m));var R=new THREE.Mesh(f,h);R.position.x=t,R.position.y=n,R.position.z=a,R.rotation.order="ZYX",R.rotation.x=Math.radians(l),R.rotation.y=Math.radians(u),R.rotation.z=Math.radians(c),R.textureObj=T,R.cubename=e,p.add(R)}var a=jQuery(e);jQuery(e).bind("mousewheel",function(e){e.originalEvent.wheelDelta<0?u--:u++,e.preventDefault()}),jQuery(document).bind("keyup",function(e){87==e.which&&(w=!w,g=d.length)}),jQuery(e).bind("mouseup",function(t){var n=new THREE.Vector3(t.clientX/jQuery(e).width()*2-1,2*-(t.clientY/jQuery(e).height())+1,.5);v.unprojectVector(n,c);var a=new THREE.Raycaster(c.position,n.sub(c.position).normalize()),r=[];p.traverse(function(e){e instanceof THREE.Mesh&&r.push(e)});var i=a.intersectObjects(r);if(i.length>0){var o=i[0].object;jQuery(".string:contains('"+o.cubename+"')")[0].scrollIntoView(!0),jQuery(document).scrollTop(0)}}),jQuery(document).bind("mousemove",e,function(e){H&&(y=e.pageX)}),c=new THREE.PerspectiveCamera(75,a.width()/a.height(),1,1e4),c.position.z=1e3,p=new THREE.Scene,t(0,3),t(0,-3),t(3,0),t(-3,0);var r=!0;if(null!=l.file("texture.png")){r=!1;var i=String.fromCharCode.apply(null,new Uint16Array(l.file("texture.png").asUint8Array())),m=window.btoa(i),R="data:image/png;base64,"+m,b=new Image;b.onload=function(){T.image=b,T.needsUpdate=!0},b.src=R,T.wrapS=THREE.ClampToEdgeWrapping,T.wrapT=THREE.ClampToEdgeWrapping,T.magFilter=THREE.NearestFilter,T.minFilter=THREE.NearestFilter}for(var M=o,j=s,x=0;x<d.length;x++){var Q=d[x];n(Q.name,Q.position[0],-Q.position[1],Q.position[2],Q.dimensions[0],Q.dimensions[1],Q.dimensions[2],Q.rotation[0],Q.rotation[1],Q.rotation[2],Q.offset[0],Q.offset[1],Q.offset[2],Q.txOffset[0],Q.txOffset[1])}var z={alpha:!0,antialias:!0};E=Detector.webgl?new THREE.WebGLRenderer(z):new THREE.CanvasRenderer(z),E.setClearColor(16777215,1),E.setSize(a.width(),a.height());var C=jQuery(E.domElement);jQuery(e).append(C)}function i(){requestAnimationFrame(i),p.traverse(function(e){e instanceof THREE.Mesh&&(w?g>0&&(e.material=null,e.material=new THREE.MeshBasicMaterial({color:0,wireframe:!0}),e.material.needsUpdate=!0,g--):g>0&&(g--,e.material=new THREE.MeshPhongMaterial({map:T,transparent:!0,opacity:1})))});var e=u,t=3.2;m-=.002,H&&(R>y?m+=.005:m-=.005),c.position.y=0,c.position.x=p.position.x+e*Math.cos(t*m),c.position.z=p.position.z+e*Math.sin(t*m),c.lookAt(p.position),E.render(p,c)}if(t)throw t;var o,s,l=new JSZip(n),u=30;Math.degrees=function(e){return 180*e/Math.PI},Math.radians=function(e){return e/180*Math.PI};var c,p,E,f,h,d=[],m=30,w=!1,g=0,T=new THREE.Texture,v=new THREE.Projector;jQuery(function(){var e=l.file("model.json").asText(),t=JSON.parse(e);jQuery("#statspanel").html(a(t));$.each(t,function(e,t){"cubes"==e&&$.each(t,function(e,t){d.push(t)}),"textureWidth"==e&&(o=t),"textureHeight"==e&&(s=t)}),setTimeout(function(){r(),i()},100)});var y=-1,R=-1,H=!1})}},Tabula=new tbl;
