var tbl=function(){this.render_model=function(e,n){JSZipUtils.getBinaryContent(n,function(n,t){function a(){function n(e,n){var t=new THREE.DirectionalLight(16777215,.5);t.position.set(e,1,n).normalize(),p.add(t)}function t(e,n,t,a,i,o,r,s,u,c,E,m,h,l,T){function g(e,n,t){var a=l,s=T,u=i,p=o;0==e&&(a=a+r+i,s+=r,u=r),1==e&&(a=a,s+=r,u=r),2==e&&(a+=r,s=s-o+r,p=i),3==e&&(a+=2*r,s=s-o+r,p=i),4==e&&(a+=r,s+=r),5==e&&(a=a+2*r+i,s+=r),s=y-s;var c=a/v,f=s/y-o/y;part=[new THREE.Vector2(c,f+p/y),new THREE.Vector2(c,f),new THREE.Vector2(c+u/v,f),new THREE.Vector2(c+u/v,f+p/y)],d.faceVertexUvs[0][n]=[part[0],part[1],part[3]],d.faceVertexUvs[0][t]=[part[1],part[2],part[3]]}d=new THREE.BoxGeometry(i,o,r,0,0,0),f=new THREE.MeshPhongMaterial({map:w,transparent:!0,opacity:1}),g(0,0,1),g(1,2,3),g(2,4,5),g(3,6,7),g(4,8,9),g(5,10,11),d.applyMatrix((new THREE.Matrix4).makeTranslation(-i/2-E,-o/2-m,-r/2-h));var H=new THREE.Mesh(d,f);H.position.x=n,H.position.y=t,H.position.z=a,H.rotation.order="ZYX",H.rotation.x=Math.radians(s),H.rotation.y=Math.radians(u),H.rotation.z=Math.radians(c),H.cubename=e,p.add(H)}var a=jQuery(e);jQuery(document).bind("mousedown",e,function(e){T=!0,h=e.pageX}),jQuery(document).bind("mouseup",e,function(e){T=!1,h=e.pageX}),jQuery(document).bind("mousemove",e,function(e){T&&(h=e.pageX)}),u=new THREE.PerspectiveCamera(75,a.width()/a.height(),1,1e4),u.position.z=1e3,p=new THREE.Scene,n(0,3),n(0,-3),n(3,0),n(-3,0);var i=String.fromCharCode.apply(null,new Uint16Array(s.file("texture.png").asUint8Array())),m=window.btoa(i),l="data:image/png;base64,"+m,w=new THREE.Texture,g=new Image;g.onload=function(){w.image=g,w.needsUpdate=!0},g.src=l,w.wrapS=THREE.ClampToEdgeWrapping,w.wrapT=THREE.ClampToEdgeWrapping,w.magFilter=THREE.NearestFilter,w.minFilter=THREE.NearestFilter;for(var v=o,y=r,H=0;H<E.length;H++){var x=E[H];t(x.name,x.position[0],-x.position[1],x.position[2],x.dimensions[0],x.dimensions[1],x.dimensions[2],x.rotation[0],x.rotation[1],x.rotation[2],x.offset[0],x.offset[1],x.offset[2],x.txOffset[0],x.txOffset[1])}c=new THREE.WebGLRenderer({alpha:!0}),c.setClearColor(0,1),c.setSize(a.width(),a.height());var R=jQuery(c.domElement);jQuery(e).append(R)}function i(){requestAnimationFrame(i),p.traverse(function(e){if(e instanceof THREE.Mesh&&(0!=e.rotation.x,"undefined"!=typeof e.cubename&&("bipedHead"==e.cubename,-1!==e.cubename.indexOf("Leg")))){{Math.radians(Math.sin(10*m))}-1!==e.cubename.indexOf("Left")}});var e=30,n=3.2;m-=.002,T&&(l>h?m+=.005:m-=.005),u.position.y=10,u.position.x=p.position.x+e*Math.cos(n*m),u.position.z=p.position.z+e*Math.sin(n*m),u.lookAt(p.position),c.render(p,u)}if(n)throw n;var o,r,s=new JSZip(t);Math.degrees=function(e){return 180*e/Math.PI},Math.radians=function(e){return e/180*Math.PI};var u,p,c,d,f,E=[],m=30;jQuery(function(){var e=s.file("model.json").asText(),n=JSON.parse(e);$.each(n,function(e,n){"cubes"==e&&$.each(n,function(e,n){E.push(n)}),"textureWidth"==e&&(o=n),"textureHeight"==e&&(r=n)}),setTimeout(function(){a(),i()},100),jQuery("#hiderender").click(function(){jQuery("#canvas").html("")})});var h=-1,l=-1,T=!1})}},Tabula=new tbl;
